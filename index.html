<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa Virtual - Â¡Participa y Gana!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .prize-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .prize-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border: 3px dashed #ccc;
        }

        .prize-image span {
            color: #666;
            font-size: 1.2em;
        }

        .prize-info h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .prize-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #e8f5e8;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .price-info span {
            font-size: 1.3em;
            font-weight: bold;
            color: #27ae60;
        }

        .progress-section {
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .participation-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .number-selector {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .number-btn {
            padding: 15px 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: center;
        }

        .number-btn:hover {
            background: #f0f0f0;
            border-color: #667eea;
        }

        .number-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .number-btn.sold {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
            cursor: not-allowed;
        }

        .buy-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .buy-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .participants-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 30px;
        }

        .participants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .participant-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal-content h3 {
            color: #27ae60;
            margin-bottom: 20px;
        }

        .close-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 30px;
        }

        .admin-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .admin-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .admin-btn.primary {
            background: #3498db;
            color: white;
        }

        .admin-btn.success {
            background: #27ae60;
            color: white;
        }

        .admin-btn.danger {
            background: #e74c3c;
            color: white;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .number-selector {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ‰ Rifa Virtual ðŸŽ‰</h1>
            <p>Â¡Participa y gana increÃ­bles premios!</p>
            <p style="margin-top: 10px; font-size: 1.1em; color: rgba(255, 255, 255, 0.9);">
                <strong>Responsable:</strong> Diana Navarro
            </p>
        </div>

        <div class="main-content">
            <div class="prize-section">
                <div class="prize-image">
                    <span>ðŸ’° Premio: $1,000,000 COP</span>
                </div>
                <div class="prize-info">
                    <h2>Premio de $1,000,000 COP</h2>
                    <div class="prize-details">
                        <p><strong>Premio:</strong> Un millÃ³n de pesos en efectivo</p>
                        <p><strong>Valor:</strong> $1,000,000 COP</p>
                        <p><strong>Fecha del sorteo:</strong> 2 de Agosto, 2025</p>
                        <p><strong>Sorteo:</strong> LoterÃ­a de BoyacÃ¡</p>
                    </div>
                    <div class="price-info">
                        <span>Precio por boleta:</span>
                        <span>$20,000 COP</span>
                    </div>
                    <div class="progress-section">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBar" style="width: 0%">
                                <span id="progressText">0%</span>
                            </div>
                        </div>
                        <p><span id="soldCount">0</span> de <span id="totalNumbers">100</span> nÃºmeros vendidos</p>
                    </div>
                </div>
            </div>

            <div class="participation-section">
                <h2>Participa Ahora</h2>
                <form id="participationForm">
                    <div class="form-group">
                        <label for="participantName">Nombre completo:</label>
                        <input type="text" id="participantName" name="participantName" required>
                    </div>
                    <div class="form-group">
                        <label for="participantEmail">Email:</label>
                        <input type="email" id="participantEmail" name="participantEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="participantPhone">TelÃ©fono:</label>
                        <input type="tel" id="participantPhone" name="participantPhone" required pattern="[0-9]{10,}">
                    </div>
                    <div class="form-group">
                        <label>Selecciona tus nÃºmeros (mÃ¡ximo 5):</label>
                        <div class="number-selector" id="numberSelector">
                            <!-- Los nÃºmeros se generarÃ¡n con JavaScript -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="color: #27ae60; font-size: 1.1em; margin-bottom: 15px;">
                            ðŸ’³ MÃ©todos de Pago:
                        </label>
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                            <p style="margin-bottom: 10px; font-weight: bold; color: #2c3e50;">
                                ðŸ“± Nequi y/o Daviplata:
                            </p>
                            <p style="font-size: 1.2em; color: #27ae60; font-weight: bold; margin-bottom: 10px;">
                                +57 319 6433317
                            </p>
                            <p style="color: #666; font-size: 0.9em;">
                                DespuÃ©s de realizar el pago, envÃ­a el comprobante por WhatsApp
                            </p>
                        </div>
                    </div>
                    <button type="submit" class="buy-btn" id="buyBtn" disabled>
                        Seleccionar NÃºmeros
                    </button>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
                        <p style="color: #856404; margin: 0; font-size: 0.9em;">
                            <strong>Importante:</strong> DespuÃ©s de seleccionar tus nÃºmeros, realiza el pago y envÃ­a el comprobante al WhatsApp +57 319 6433317
                        </p>
                    </div>
                </form>
            </div>
        </div>

        <div class="participants-section">
            <h2>Participantes Actuales</h2>
            <div class="participants-grid" id="participantsList">
                <!-- Los participantes se mostrarÃ¡n aquÃ­ -->
            </div>
        </div>

        <div class="admin-section">
            <h2>Panel de AdministraciÃ³n</h2>
            <div class="admin-controls">
                <button class="admin-btn primary" onclick="exportParticipants()">Exportar Participantes</button>
                <button class="admin-btn success" onclick="drawWinner()">Realizar Sorteo</button>
                <button class="admin-btn danger" onclick="resetRaffle()">Reiniciar Rifa</button>
            </div>
        </div>
    </div>

    <!-- Modal para confirmaciÃ³n -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <h3>Â¡NÃºmeros Reservados!</h3>
            <p id="confirmationMessage"></p>
            <a href="https://wa.me/573196433317" target="_blank" style="background: #25d366; color: white; padding: 12px 24px; text-decoration: none; border-radius: 10px; display: inline-block; margin: 15px 5px; font-weight: bold;">
                ðŸ’¬ Enviar Comprobante por WhatsApp
            </a>
            <button class="close-btn" onclick="closeModal()">Cerrar</button>
        </div>
    </div>

    <!-- Modal para sorteo -->
    <div class="modal" id="winnerModal">
        <div class="modal-content">
            <h3>ðŸŽ‰ Â¡Tenemos un Ganador! ðŸŽ‰</h3>
            <p id="winnerMessage"></p>
            <button class="close-btn" onclick="closeModal()">Cerrar</button>
        </div>
    </div>

    <script>
        // ConfiguraciÃ³n de la rifa
        const raffleConfig = {
            totalNumbers: 100,
            maxSelections: 5,
            pricePerNumber: 20000
        };

        // Datos de la rifa
        let raffleData = {
            participants: [],
            soldNumbers: [],
            selectedNumbers: []
        };

        // Inicializar la pÃ¡gina
        document.addEventListener('DOMContentLoaded', function() {
            generateNumberSelector();
            updateProgress();
            updateParticipantsList();
            
            // Configurar el formulario
            document.getElementById('participationForm').addEventListener('submit', handlePurchase);
        });

        // Generar selector de nÃºmeros
        function generateNumberSelector() {
            const selector = document.getElementById('numberSelector');
            selector.innerHTML = '';
            
            for (let i = 1; i <= raffleConfig.totalNumbers; i++) {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'number-btn';
                button.textContent = i.toString().padStart(2, '0');
                button.dataset.number = i;
                
                if (raffleData.soldNumbers.includes(i)) {
                    button.classList.add('sold');
                    button.disabled = true;
                } else {
                    button.addEventListener('click', () => toggleNumber(i, button));
                }
                
                selector.appendChild(button);
            }
        }

        // Alternar selecciÃ³n de nÃºmero
        function toggleNumber(number, button) {
            if (button.classList.contains('selected')) {
                // Deseleccionar
                button.classList.remove('selected');
                raffleData.selectedNumbers = raffleData.selectedNumbers.filter(n => n !== number);
            } else {
                // Seleccionar si no se ha alcanzado el mÃ¡ximo
                if (raffleData.selectedNumbers.length < raffleConfig.maxSelections) {
                    button.classList.add('selected');
                    raffleData.selectedNumbers.push(number);
                } else {
                    alert(`Solo puedes seleccionar mÃ¡ximo ${raffleConfig.maxSelections} nÃºmeros`);
                }
            }
            
            updateBuyButton();
        }

        // Actualizar botÃ³n de compra
        function updateBuyButton() {
            const buyBtn = document.getElementById('buyBtn');
            const selectedCount = raffleData.selectedNumbers.length;
            
            if (selectedCount > 0) {
                buyBtn.disabled = false;
                const total = selectedCount * raffleConfig.pricePerNumber;
                buyBtn.textContent = `Reservar ${selectedCount} nÃºmero${selectedCount > 1 ? 's' : ''} - ${total.toLocaleString()} COP`;
            } else {
                buyBtn.disabled = true;
                buyBtn.textContent = 'Seleccionar NÃºmeros';
            }
        }

        // Manejar compra
        function handlePurchase(e) {
            e.preventDefault();
            
            const name = document.getElementById('participantName').value;
            const email = document.getElementById('participantEmail').value;
            const phone = document.getElementById('participantPhone').value;
            
            if (raffleData.selectedNumbers.length === 0) {
                alert('Por favor selecciona al menos un nÃºmero');
                return;
            }
            
            // Crear participante
            const participant = {
                id: Date.now(),
                name: name,
                email: email,
                phone: phone,
                numbers: [...raffleData.selectedNumbers],
                purchaseDate: new Date().toLocaleDateString(),
                totalPaid: raffleData.selectedNumbers.length * raffleConfig.pricePerNumber
            };
            
            // Agregar a participantes
            raffleData.participants.push(participant);
            
            // Marcar nÃºmeros como vendidos
            raffleData.soldNumbers.push(...raffleData.selectedNumbers);
            
            // Limpiar selecciÃ³n
            raffleData.selectedNumbers = [];
            
            // Actualizar interfaz
            generateNumberSelector();
            updateProgress();
            updateParticipantsList();
            
            // Mostrar confirmaciÃ³n
            showConfirmation(participant);
            
            // Limpiar formulario
            document.getElementById('participationForm').reset();
            updateBuyButton();
        }

        // Mostrar confirmaciÃ³n
        function showConfirmation(participant) {
            const total = participant.totalPaid.toLocaleString();
            const message = `Â¡Gracias ${participant.name}! Has reservado los nÃºmeros: ${participant.numbers.join(', ')}. Total a pagar: ${total} COP. 

Por favor realiza el pago a:
ðŸ“± Nequi/Daviplata: +57 319 6433317
Y envÃ­a el comprobante por WhatsApp al mismo nÃºmero.`;
            
            document.getElementById('confirmationMessage').innerHTML = message.replace(/\n/g, '<br>');
            document.getElementById('confirmationModal').style.display = 'block';
        }

        // Actualizar barra de progreso
        function updateProgress() {
            const soldCount = raffleData.soldNumbers.length;
            const percentage = (soldCount / raffleConfig.totalNumbers) * 100;
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressText').textContent = Math.round(percentage) + '%';
            document.getElementById('soldCount').textContent = soldCount;
            document.getElementById('totalNumbers').textContent = raffleConfig.totalNumbers;
        }

        // Actualizar lista de participantes
        function updateParticipantsList() {
            const list = document.getElementById('participantsList');
            list.innerHTML = '';
            
            raffleData.participants.forEach(participant => {
                const card = document.createElement('div');
                card.className = 'participant-card';
                card.innerHTML = `
                    <h4>${participant.name}</h4>
                    <p><strong>Email:</strong> ${participant.email}</p>
                    <p><strong>TelÃ©fono:</strong> ${participant.phone}</p>
                    <p><strong>NÃºmeros:</strong> ${participant.numbers.join(', ')}</p>
                    <p><strong>Fecha:</strong> ${participant.purchaseDate}</p>
                    <p><strong>Total a pagar:</strong> ${participant.totalPaid.toLocaleString()} COP</p>
                `;
                list.appendChild(card);
            });
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('confirmationModal').style.display = 'none';
            document.getElementById('winnerModal').style.display = 'none';
        }

        // Exportar participantes
        function exportParticipants() {
            const data = raffleData.participants.map(p => ({
                Nombre: p.name,
                Email: p.email,
                TelÃ©fono: p.phone,
                NÃºmeros: p.numbers.join(', '),
                Fecha: p.purchaseDate,
                Total: p.totalPaid
            }));
            
            const csv = convertToCSV(data);
            downloadCSV(csv, 'participantes_rifa.csv');
        }

        // Convertir a CSV
        function convertToCSV(data) {
    const headers = Object.keys(data[0]);
    const csvContent = [
        headers.join(','),
        ...data.map(row =>
            headers.map(header => {
                const value = String(row[header]).replace(/"/g, '""');
                return `"${value}"`;
            }).join(',')
        )
    ].join('\n');
    return csvContent;
}

        // Descargar CSV
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', filename);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Realizar sorteo
        function drawWinner() {
            if (raffleData.soldNumbers.length === 0) {
                alert('No hay nÃºmeros vendidos para realizar el sorteo');
                return;
            }
            
            const winningNumber = raffleData.soldNumbers[Math.floor(Math.random() * raffleData.soldNumbers.length)];
            const winner = raffleData.participants.find(p => p.numbers.includes(winningNumber));
            
            const message = `Â¡El nÃºmero ganador es ${winningNumber}! Ganador: ${winner.name} (${winner.email})`;
            document.getElementById('winnerMessage').textContent = message;
            document.getElementById('winnerModal').style.display = 'block';
        }

        // Reiniciar rifa
        function resetRaffle() {
            if (confirm('Â¿EstÃ¡s seguro de que quieres reiniciar la rifa? Se perderÃ¡n todos los datos.')) {
                raffleData = {
                    participants: [],
                    soldNumbers: [],
                    selectedNumbers: []
                };
                
                generateNumberSelector();
                updateProgress();
                updateParticipantsList();
                updateBuyButton();
                
                alert('Rifa reiniciada exitosamente');
            }
        }

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>